<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Boston's Bike Sharing System</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>

    <title>Visualizing Boston's Bike Sharing System</title>
    <link rel="stylesheet" href="styleProject.css" />

    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200" rel="stylesheet">
    <!-- <script src="loadprojectdata2.js"></script> -->
  </head>
  <body>
        <h1 id="title">Visualizing Boston's Bike Sharing System</h1>  
        <h2 id="intro">The bluebikes, formally hubway bikes, is Boston's public bike share program. Since 2012, this system has increased access to various parts of boston through an active and affordable means of transportation. The data shows trip histories between XX dates. This visualization explores the expanding network of biking stations by gender, membership and age.  </h2>  
    <svg id="my-map"></svg>
    <div id="tooltip"></div><!-- div to hold tooltip. -->
    <script>

        var width = window.innerWidth;
        var height = 700;

        d3.queue()
            .defer(d3.csv, "201812-bluebikes-tripdata.csv")
            .defer(d3.csv, "stateNames.csv")
            .defer(d3.json, "MA-25-massachusetts-counties.json")
            .awaitAll(function(error, dataArray) {

                var data = dataArray[0];
                var names = dataArray[1];
                var stateTopojson = dataArray[2];

                var geoJSON = topojson.feature(stateTopojson, stateTopojson.objects.cb_2015_massachusetts_county_20m);
                console.log(geoJSON);
               geoJSON.features = geoJSON.features.filter(function(state) {
                   return state.properties.NAME != "Barnstable" 
                   &&  state.properties.NAME != "Berkshire"
                   &&  state.properties.NAME != "Franklin" 
                   &&  state.properties.NAME != "Hampshire" 
                   &&  state.properties.NAME != "Hampden" 
                   &&  state.properties.NAME != "Worcester"
                   &&  state.properties.NAME != "Bristol"
                   &&  state.properties.NAME != "Essex"
                   &&  state.properties.NAME != "Dukes"
                   &&  state.properties.NAME != "Nantucket"
                   &&  state.properties.NAME != "Plymouth"
                 
                    ;
                });

                var projection = d3.geoMercator()
                    .fitSize([width, height], geoJSON) ;

                var path = d3.geoPath()
                    .projection(projection);

                var svg = d3.select("#my-map")
                    .attr("width", width + "px")
                    .attr("height", height + "px")
                    .style("fill", "gray")
                    .style('stroke', "black")
                    .style('stroke-width', 3)
                    .append("svg")
                    .attr("width", "100%")
                    .attr("height", "100%")
                    .call(d3.zoom().on("zoom", function () {svg.attr("transform", d3.event.transform)}))
                    .append("g");

                

                var states = svg.selectAll("path")
                    .data(geoJSON.features);

                states.enter().append("path")
                    .attr("d", function(feature) {
                        return path(feature);
                    })
                    .attr("id", function(feature){
                        return "id-"+feature.id;
                    })
               

                var nest = d3.nest()
                .key(function(d){return d.startstationname;})
                .entries(data)
                console.log(nest)

                var features = svg.append("g")
            .attr("class","features");


                    features.selectAll("circle")
                    .data(nest)
                    .enter()
                    .append("circle")
                  //  .attr("cx", function (d) {return projection([d.values[0].startstationlongitude, d.values[0].startstationlatitude])[0];})
                  // .attr("cy", function (d) {return projection([d.values[0].startstationlongitude, d.values[0].startstationlatitude])[1];})
                    .attr("transform", function(d) {
                         return "translate(" + projection([d.values[0].startstationlongitude, d.values[0].startstationlatitude]) + ")";})
// Need to fix this line below. Trying to make size of circle, the value from nest
                  .attr("r", function(d) { return d.values.length/250;})
                //     .attr("r", .5)
                    .style("fill", "blue")
                    .style("opacity", .2)
                    ;

                    function tooltipHtml(n, d){	/* function to create html content string in tooltip div. */
		return "<h4>"+n+"</h4><table>"+
			"<tr><td>Station</td><td>"+(d.key)+"</td></tr>"+
			"<tr><td>Average</td><td>"+(d.values.length)+"</td></tr>"+
			"</table>";
	}


        });

    </script>
  </body>
</html>